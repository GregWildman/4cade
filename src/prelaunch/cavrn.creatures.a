;license:MIT
;(c) 2022 by qkumba

!cpu 6502
!to "build/PRELAUNCH.INDEXED/CAVRN.CREATURES",plain
*=$106

         !source "src/prelaunch/common.a"

callback1
         +ENABLE_ACCEL

         lda   #$4C
         sta   $8F9
         lda   #<callback2
         sta   $8FA
         lda   #>callback2
         sta   $8FB
         jmp   $800       ; decompress

callback2
         lda   #<callback1
         sta   $BE13
         lda   #>callback1
         sta   $BE14
         ldx   #$60
         lda   $D49
         cmp   #'0'
         beq   patch0
         cmp   #'1'
         beq   patch1
         cmp   #'2'
         beq   patch2
         stx   $83BB
         jsr   $6000      ; decompress
         jsr   noaccel
         jmp   $800

patch0
         stx   $1812
         jsr   $1800      ; decompress
         jsr   noaccel
         jmp   $1C00

patch1
         stx   $2023
         jsr   $2000      ; decompress
         jsr   noaccel
         jmp   $4A00

patch2
         stx   $2039
         jsr   $2000      ; decompress
         jsr   noaccel
         jmp   $1A4E

noaccel
         +DISABLE_ACCEL
         rts

!if * > $1C0 {
  !error "code is too large, ends at ", *
}
